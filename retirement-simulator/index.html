<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é€€è·é‡‘ æ‰‹å–ã‚Šé¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --base-bg:     #e8f5f1;
  --accent:      #a8d5ba;
  --accent-deep: #4a8c6f;
  --text-main:   #44504c;
  --text-sub:    #ccd6d1;
  --card-bg:     #ffffff;
  --mint-light:  #d4ede3;
  --mint-pale:   #f0faf5;
  --shadow:      rgba(74, 140, 111, 0.12);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN W3', 'Hiragino Sans', sans-serif;
  background-color: var(--base-bg);
  background-image:
    radial-gradient(circle at 15% 15%, rgba(168,213,186,0.3) 0%, transparent 40%),
    radial-gradient(circle at 85% 80%, rgba(74,140,111,0.12) 0%, transparent 35%);
  min-height: 100vh;
  color: var(--text-main);
  padding: 24px 16px 60px;
  position: relative;
  overflow-x: hidden;
}

/* ---- particles ---- */
#particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
#confetti-wrap { position: fixed; inset: 0; pointer-events: none; z-index: 100; overflow: hidden; }

@keyframes particleDrift {
  0%   { transform: translateY(100vh) scale(0) rotate(0deg);   opacity: 0; }
  10%  { opacity: 1; }
  90%  { opacity: 1; }
  100% { transform: translateY(-20px) scale(1) rotate(360deg); opacity: 0; }
}

@keyframes confettiFall {
  0%   { transform: translateY(-20px) rotate(0deg)   scale(0);   opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg) scale(0.4); opacity: 0; }
}

/* ---- toast ---- */
.toast {
  position: fixed; bottom: 30px; left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--accent-deep); color: #fff;
  padding: 12px 28px; border-radius: 40px;
  font-size: 13px; letter-spacing: 0.08em;
  box-shadow: 0 6px 24px rgba(74, 140, 111, 0.4);
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease;
  opacity: 0; z-index: 1000; white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

/* ---- wrapper ---- */
.wrapper {
  position: relative; z-index: 1;
  max-width: 680px; margin: 0 auto;
}

/* ---- header ---- */
header {
  text-align: center;
  margin-bottom: 28px;
  animation: fadeInDown 0.8s cubic-bezier(0.22, 0.61, 0.36, 1) both;
}
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to   { opacity: 1; transform: translateY(0); }
}
.badge {
  display: inline-flex; align-items: center; gap: 5px;
  background: var(--accent); color: var(--accent-deep);
  padding: 5px 14px; border-radius: 20px;
  font-size: 11px; font-weight: 500;
  margin-bottom: 12px;
  box-shadow: 0 2px 12px rgba(168, 213, 186, 0.5);
  animation: pulseBadge 3s ease-in-out infinite;
}
@keyframes pulseBadge {
  0%, 100% { box-shadow: 0 2px 12px rgba(168, 213, 186, 0.5); }
  50%       { box-shadow: 0 4px 22px rgba(74, 140, 111, 0.45); }
}
h1 {
  font-size: clamp(22px, 5vw, 28px);
  color: var(--text-main);
  font-weight: 700;
  letter-spacing: -0.02em;
  line-height: 1.3;
  margin-bottom: 8px;
}
.subtitle {
  font-size: 13px; color: #7a9a8e;
}

/* ---- card ---- */
.card {
  background: var(--card-bg);
  border-radius: 28px;
  padding: 36px 36px 32px;
  box-shadow:
    0 8px 40px rgba(74, 140, 111, 0.12),
    0 1px 4px rgba(0,0,0,0.04),
    inset 0 1px 0 rgba(255,255,255,0.8);
  position: relative;
  overflow: hidden;
  margin-bottom: 20px;
  animation: fadeInUp 0.7s 0.2s cubic-bezier(0.22, 0.61, 0.36, 1) both;
}
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(28px); }
  to   { opacity: 1; transform: translateY(0); }
}
.card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 4px;
  background: linear-gradient(90deg, #a8d5ba, #4a8c6f, #a8d5ba);
  background-size: 200% 100%;
  animation: shimmerBar 3s linear infinite;
}
@keyframes shimmerBar {
  0%   { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ---- section title ---- */
.section-title {
  font-size: 13px; font-weight: 500; color: var(--accent-deep);
  margin-bottom: 18px; display: flex; align-items: center; gap: 6px;
}
.section-title::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, #d4ede3, transparent);
}

/* ---- form group ---- */
.form-group { margin-bottom: 22px; }
.form-label {
  font-size: 12px; font-weight: 500; color: #7a9a8e;
  margin-bottom: 7px; display: flex; align-items: center; gap: 4px;
}
.form-label .tip {
  font-size: 11px; color: var(--accent);
  background: var(--mint-pale); padding: 2px 8px; border-radius: 20px;
  margin-left: 4px;
}

.input-wrap {
  position: relative;
}
.input-wrap input[type="number"],
.input-wrap input[type="text"] {
  width: 100%;
  background: var(--mint-pale);
  border: 2px solid var(--mint-light);
  border-radius: 16px;
  padding: 13px 52px 13px 18px;
  font-family: 'Roboto', sans-serif;
  font-weight: 300;
  font-size: 22px;
  color: var(--text-main);
  outline: none;
  transition: border 0.2s, background 0.2s, box-shadow 0.2s;
  -moz-appearance: textfield;
}
.input-wrap input::-webkit-outer-spin-button,
.input-wrap input::-webkit-inner-spin-button { -webkit-appearance: none; }
.input-wrap input::placeholder {
  color: #b8d4cc; font-weight: 300; font-size: 18px;
}
.input-wrap input:focus {
  background: #fff;
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(168,213,186,0.25);
}
.input-unit {
  position: absolute; right: 16px; top: 50%;
  transform: translateY(-50%);
  font-size: 14px; color: #7a9a8e; font-weight: 400;
  pointer-events: none;
}

/* quick buttons */
.quick-btns {
  display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;
}
.quick-btn {
  padding: 6px 16px; border-radius: 20px;
  background: var(--mint-pale); border: 1.5px solid var(--mint-light);
  font-size: 12px; font-weight: 500; color: #7a9a8e;
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.quick-btn:hover { transform: scale(1.08); background: var(--accent); color: #fff; border-color: var(--accent); }
.quick-btn:active { transform: scale(0.95); }
.quick-btn.active { background: var(--accent-deep); color: #fff; border-color: var(--accent-deep); box-shadow: 0 2px 12px rgba(74,140,111,0.35); }

/* radio group */
.radio-group {
  display: flex; flex-wrap: wrap; gap: 8px; margin-top: 4px;
}
.radio-btn {
  padding: 8px 18px; border-radius: 20px;
  background: var(--mint-pale); border: 1.5px solid var(--mint-light);
  font-size: 12px; font-weight: 500; color: #7a9a8e;
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  user-select: none;
}
.radio-btn:hover { transform: scale(1.05); }
.radio-btn.active { background: var(--accent-deep); color: #fff; border-color: var(--accent-deep); box-shadow: 0 2px 12px rgba(74,140,111,0.35); }

/* checkbox */
.checkbox-label {
  display: flex; align-items: center; gap: 10px;
  cursor: pointer; font-size: 13px; color: var(--text-main);
  user-select: none;
}
.checkbox-label input[type="checkbox"] { display: none; }
.custom-checkbox {
  width: 20px; height: 20px; border-radius: 6px;
  border: 2px solid var(--mint-light);
  background: var(--mint-pale);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s ease; flex-shrink: 0;
}
.checkbox-label input:checked + .custom-checkbox {
  background: var(--accent-deep); border-color: var(--accent-deep);
}
.custom-checkbox::after {
  content: 'âœ“'; font-size: 12px; color: #fff; opacity: 0; transition: 0.15s;
}
.checkbox-label input:checked + .custom-checkbox::after { opacity: 1; }

/* conditional section */
.conditional-section {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 0.4s cubic-bezier(0.22, 0.61, 0.36, 1), opacity 0.3s ease, margin 0.3s;
  margin-top: 0;
}
.conditional-section.open {
  max-height: 300px; opacity: 1; margin-top: 16px;
}

/* divider */
.divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, #d4ede3, transparent);
  margin: 24px 0;
}

/* ---- calc btn ---- */
.calc-btn {
  width: 100%; padding: 16px;
  background: linear-gradient(135deg, #a8d5ba, #4a8c6f);
  border: none; border-radius: 20px;
  color: #fff; font-size: 15px; font-weight: 500;
  letter-spacing: 0.05em; cursor: pointer;
  box-shadow: 0 4px 20px rgba(74,140,111,0.35);
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
  font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
}
.calc-btn:hover { transform: translateY(-2px) scale(1.01); box-shadow: 0 8px 28px rgba(74,140,111,0.4); }
.calc-btn:active { transform: scale(0.98); }

/* ---- result card ---- */
.result-card {
  background: var(--card-bg);
  border-radius: 28px;
  padding: 32px;
  box-shadow:
    0 8px 40px rgba(74, 140, 111, 0.12),
    0 1px 4px rgba(0,0,0,0.04),
    inset 0 1px 0 rgba(255,255,255,0.8);
  position: relative; overflow: hidden;
  animation: fadeInUp 0.6s cubic-bezier(0.22, 0.61, 0.36, 1) both;
  display: none;
}
.result-card.show { display: block; }
.result-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 4px;
  background: linear-gradient(90deg, #4a8c6f, #a8d5ba, #4a8c6f);
  background-size: 200% 100%;
  animation: shimmerBar 3s linear infinite;
}

.result-main {
  background: linear-gradient(135deg, #f0faf6, #e8f5f1);
  border-radius: 20px;
  padding: 24px 28px;
  margin-bottom: 20px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(74,140,111,0.12);
}
.result-main-label {
  font-size: 12px; font-weight: 500; color: #7a9a8e; margin-bottom: 4px;
}
.result-main-value {
  font-family: 'Roboto', sans-serif;
  font-weight: 300; font-size: 44px;
  color: var(--accent-deep); letter-spacing: -0.02em; line-height: 1;
  display: flex; align-items: baseline; justify-content: center; gap: 6px;
}
.result-main-value .unit {
  font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
  font-size: 16px; font-weight: 400; color: #7a9a8e;
}

/* result items grid */
.result-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 20px;
}
.result-item {
  background: var(--mint-pale);
  border-radius: 16px;
  padding: 16px;
  border: 1.5px solid var(--mint-light);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.result-item:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(74,140,111,0.12); }
.result-item-label {
  font-size: 11px; font-weight: 500; color: #7a9a8e; margin-bottom: 5px;
}
.result-item-value {
  font-family: 'Roboto', sans-serif; font-weight: 400; font-size: 20px;
  color: var(--text-main);
}
.result-item-value .unit { font-family: 'Hiragino Kaku Gothic ProN', sans-serif; font-size: 12px; color: #7a9a8e; }

/* donut + bar area */
.visual-area {
  display: flex; align-items: center; gap: 20px;
  margin-bottom: 24px;
}
.donut-wrap { flex-shrink: 0; position: relative; }
.donut-center-label {
  position: absolute; inset: 0; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  font-size: 10px; color: #7a9a8e; text-align: center; line-height: 1.3;
}
.donut-center-label strong { font-size: 13px; color: var(--accent-deep); font-family: 'Roboto', sans-serif; font-weight: 500; }

.bar-area { flex: 1; }
.bar-label-row {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 6px;
}
.bar-label-text { font-size: 11px; color: #7a9a8e; font-weight: 500; }
.bar-label-pct { font-size: 11px; color: var(--accent-deep); font-family: 'Roboto', sans-serif; font-weight: 500; }
.ratio-bar {
  height: 8px; background: var(--mint-light); border-radius: 8px; overflow: hidden; margin-bottom: 10px;
}
.ratio-bar-fill {
  height: 100%; border-radius: 8px;
  background: linear-gradient(90deg, #a8d5ba, #4a8c6f);
  transition: width 1s cubic-bezier(0.22, 0.61, 0.36, 1);
  position: relative; overflow: hidden;
  width: 0%;
}
.ratio-bar-fill::after {
  content: ''; position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: barShimmer 2s ease-in-out infinite;
}
@keyframes barShimmer {
  0%   { left: -100%; }
  100% { left: 200%; }
}
.ratio-bar.tax-bar .ratio-bar-fill {
  background: linear-gradient(90deg, #f0c4b8, #d4907a);
}

/* calc basis box */
.calc-basis {
  background: var(--mint-pale);
  border: 1px dashed var(--mint-light);
  border-radius: 12px;
  padding: 18px 20px;
  margin-top: 4px;
}
.calc-basis-title {
  font-size: 12px; font-weight: 500; color: var(--accent-deep); margin-bottom: 10px;
  display: flex; align-items: center; gap: 4px;
}
.calc-step {
  display: flex; align-items: flex-start; gap: 8px;
  margin-bottom: 7px; font-size: 12px; color: var(--text-main); line-height: 1.6;
}
.step-num {
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--accent); color: #fff;
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; flex-shrink: 0; margin-top: 2px;
}
.calc-step .val {
  font-family: 'Roboto', sans-serif; font-weight: 500; color: var(--accent-deep);
}
.calc-eq {
  font-size: 13px; color: var(--text-main);
  background: #fff; border: 1.5px solid var(--mint-light); border-radius: 10px;
  padding: 10px 14px; margin-top: 10px; line-height: 1.8;
  font-family: 'Roboto', sans-serif;
}
.calc-eq .em { color: var(--accent-deep); font-weight: 500; }

/* disclaimer */
.disclaimer {
  margin-top: 28px;
  background: rgba(255,255,255,0.6);
  border-left: 3px solid var(--accent);
  border-radius: 12px;
  padding: 16px 18px;
}
.disclaimer-title { font-size: 12px; font-weight: 500; color: #7a9a8e; margin-bottom: 8px; }
.disclaimer p {
  font-size: 11px; color: #a0bdb5; line-height: 1.8;
}
.disclaimer a { color: var(--accent-deep); text-decoration: none; border-bottom: 1px solid var(--mint-light); }
.disclaimer a:hover { color: #2d7a5a; }

/* initial placeholder */
.empty-state {
  text-align: center; padding: 40px 20px; color: #7a9a8e;
  background: var(--card-bg); border-radius: 28px;
  box-shadow: 0 8px 40px var(--shadow);
  animation: fadeInUp 0.7s 0.35s cubic-bezier(0.22, 0.61, 0.36, 1) both;
  display: block;
}
.empty-state .icon { font-size: 40px; margin-bottom: 12px; }
.empty-state p { font-size: 13px; line-height: 1.7; }

/* responsive */
@media (max-width: 540px) {
  .card { padding: 28px 20px; }
  .result-grid { grid-template-columns: 1fr; }
  .visual-area { flex-direction: column; }
  .result-main-value { font-size: 36px; }
}
</style>
</head>
<body>
<div id="particles"></div>
<div id="confetti-wrap"></div>
<div class="toast" id="toast"></div>

<div class="wrapper">
  <!-- header -->
  <header>
    <div class="badge">âœ¨ ã‹ã‚“ãŸã‚“ç¨é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    <h1>ğŸ’´ é€€è·é‡‘ æ‰‹å–ã‚Šé¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p class="subtitle">é€€è·æ‰€å¾—æ§é™¤ãƒ»æ‰€å¾—ç¨ãƒ»ä½æ°‘ç¨ã‚’è€ƒæ…®ã—ãŸæ‰‹å–ã‚Šé¡ã‚’ã‹ã‚“ãŸã‚“è¨ˆç®—</p>
  </header>

  <!-- input card -->
  <div class="card">
    <p class="section-title">ğŸ“ é€€è·æƒ…å ±ã‚’å…¥åŠ›</p>

    <!-- é€€è·é‡‘é¡ -->
    <div class="form-group">
      <div class="form-label">ğŸ’´ é€€è·é‡‘ã®å—å–é¡ï¼ˆç¨å¼•ãå‰ï¼‰</div>
      <div class="input-wrap">
        <input type="text" id="retirementAmount" placeholder="ä¾‹ï¼š15,000,000" inputmode="numeric">
        <span class="input-unit">å††</span>
      </div>
      <div class="quick-btns" id="amountBtns">
        <button class="quick-btn" data-val="5000000">500ä¸‡</button>
        <button class="quick-btn" data-val="10000000">1,000ä¸‡</button>
        <button class="quick-btn" data-val="20000000">2,000ä¸‡</button>
        <button class="quick-btn" data-val="30000000">3,000ä¸‡</button>
        <button class="quick-btn" data-val="50000000">5,000ä¸‡</button>
      </div>
    </div>

    <!-- é€€è·ã®ç¨®é¡ -->
    <div class="form-group">
      <div class="form-label">ğŸ¢ é€€è·ã®ç¨®é¡</div>
      <div class="radio-group" id="retirementType">
        <div class="radio-btn active" data-val="general">ä¸€èˆ¬é€€è·ï¼ˆä¼šç¤¾å“¡ãƒ»å…¬å‹™å“¡ç­‰ï¼‰</div>
        <div class="radio-btn" data-val="officer">ç‰¹å®šå½¹å“¡é€€è·ï¼ˆå½¹å“¡5å¹´ä»¥ä¸‹ï¼‰</div>
        <div class="radio-btn" data-val="short">çŸ­æœŸé€€è·ï¼ˆä¸€èˆ¬ãƒ»5å¹´ä»¥ä¸‹ï¼‰</div>
        <div class="radio-btn" data-val="ideco">iDeCoä¸€æ™‚é‡‘ã®ã¿</div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- å‹¤ç¶šå¹´æ•° -->
    <div class="form-group">
      <div class="form-label" id="yearsLabel">ğŸ“… å‹¤ç¶šå¹´æ•°</div>
      <div class="input-wrap">
        <input type="number" id="yearsOfService" placeholder="ä¾‹ï¼š30" min="1" max="50">
        <span class="input-unit">å¹´</span>
      </div>
      <div style="font-size: 11px; color: #a0bdb5; margin-top: 5px;">â€» 1å¹´æœªæº€ã®ç«¯æ•°ã¯1å¹´ã«åˆ‡ã‚Šä¸Šã’</div>
      <div class="quick-btns" id="yearsBtns">
        <button class="quick-btn" data-val="5">5å¹´</button>
        <button class="quick-btn" data-val="10">10å¹´</button>
        <button class="quick-btn" data-val="20">20å¹´</button>
        <button class="quick-btn" data-val="30">30å¹´</button>
        <button class="quick-btn" data-val="40">40å¹´</button>
      </div>
    </div>

    <!-- éšœå®³è€…é€€è· -->
    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" id="disability">
        <span class="custom-checkbox"></span>
        <span>éšœå®³è€…ã«ãªã£ãŸã“ã¨ãŒç›´æ¥ã®åŸå› ã§é€€è·ã—ãŸï¼ˆæ§é™¤é¡ã«+100ä¸‡å††ï¼‰</span>
      </label>
    </div>

    <!-- iDeCo ãƒã‚§ãƒƒã‚¯ -->
    <div id="idecoSection">
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" id="hasIdeco">
          <span class="custom-checkbox"></span>
          <span>iDeCoä¸€æ™‚é‡‘ã‚‚åŒå¹´ã«å—ã‘å–ã‚‹ï¼ˆä¼šç¤¾é€€è·é‡‘ã¨åˆç®—ã—ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</span>
        </label>
        <div class="conditional-section" id="idecoDetails">
          <div class="form-group" style="margin-bottom: 0;">
            <div class="form-label">iDeCo å—å–é¡</div>
            <div class="input-wrap">
              <input type="text" id="idecoAmount" placeholder="ä¾‹ï¼š2,000,000" inputmode="numeric">
              <span class="input-unit">å††</span>
            </div>
          </div>
          <div class="form-group" style="margin-top: 14px; margin-bottom: 0;">
            <div class="form-label">iDeCo åŠ å…¥æœŸé–“</div>
            <div class="input-wrap">
              <input type="number" id="idecoYears" placeholder="ä¾‹ï¼š20" min="1" max="40">
              <span class="input-unit">å¹´</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¨ˆç®—ãƒœã‚¿ãƒ³ -->
    <button class="calc-btn" id="calcBtn" onclick="calculate()">ğŸŒ¿ æ‰‹å–ã‚Šé¡ã‚’è¨ˆç®—ã™ã‚‹</button>
  </div>

  <!-- empty state -->
  <div class="empty-state" id="emptyState">
    <div class="icon">ğŸŒ±</div>
    <p>é€€è·æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€<br>æ‰‹å–ã‚Šé¡ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã—ã‚‡ã†ã€‚</p>
  </div>

  <!-- result card -->
  <div class="result-card" id="resultCard">
    <p class="section-title">ğŸ“Š ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</p>

    <!-- main -->
    <div class="result-main">
      <div class="result-main-label">ğŸ‰ æ¨å®š æ‰‹å–ã‚Šé¡ï¼ˆç¨ãƒ»ä½æ°‘ç¨å¼•ãå¾Œï¼‰</div>
      <div class="result-main-value">
        <span id="takeHomeNum">0</span>
        <span class="unit">å††</span>
      </div>
    </div>

    <!-- donut + bars -->
    <div class="visual-area">
      <div class="donut-wrap">
        <svg width="100" height="100" viewBox="0 0 88 88">
          <circle cx="44" cy="44" r="33" fill="none" stroke="#d4ede3" stroke-width="15"/>
          <circle id="donut-ded" cx="44" cy="44" r="33" fill="none" stroke="#a8d5ba" stroke-width="15"
            stroke-dasharray="0 207.3" stroke-linecap="round"
            transform="rotate(-90 44 44)"
            style="transition: stroke-dasharray 1s cubic-bezier(0.22,0.61,0.36,1)"/>
          <circle id="donut-tax" cx="44" cy="44" r="33" fill="none" stroke="#d4907a" stroke-width="15"
            stroke-dasharray="0 207.3" stroke-linecap="round"
            transform="rotate(-90 44 44)"
            style="transition: stroke-dasharray 1s cubic-bezier(0.22,0.61,0.36,1), stroke-dashoffset 1s cubic-bezier(0.22,0.61,0.36,1)"/>
          <circle id="donut-take" cx="44" cy="44" r="33" fill="none" stroke="#4a8c6f" stroke-width="15"
            stroke-dasharray="0 207.3" stroke-linecap="round"
            transform="rotate(-90 44 44)"
            style="transition: stroke-dasharray 1s cubic-bezier(0.22,0.61,0.36,1), stroke-dashoffset 1s cubic-bezier(0.22,0.61,0.36,1)"/>
        </svg>
        <div class="donut-center-label">
          <div id="donutPct">-</div>
          <div style="font-size: 9px;">æ‰‹å–ã‚Šç‡</div>
        </div>
      </div>
      <div class="bar-area">
        <div class="bar-label-row">
          <span class="bar-label-text"><span style="color:#4a8c6f;font-size:10px;">â—</span> æ‰‹å–ã‚Šé¡</span>
          <span class="bar-label-pct" id="takePct">-</span>
        </div>
        <div class="ratio-bar"><div class="ratio-bar-fill" id="takeBar"></div></div>

        <div class="bar-label-row">
          <span class="bar-label-text"><span style="color:#c4806a;font-size:10px;">â—</span> ç¨é‡‘åˆè¨ˆï¼ˆæ‰€å¾—ç¨+ä½æ°‘ç¨ï¼‰</span>
          <span class="bar-label-pct" id="taxPct">-</span>
        </div>
        <div class="ratio-bar tax-bar"><div class="ratio-bar-fill" id="taxBar"></div></div>
      </div>
    </div>

    <!-- grid items -->
    <div class="result-grid">
      <div class="result-item">
        <div class="result-item-label">ğŸ“¥ é€€è·é‡‘å—å–é¡</div>
        <div class="result-item-value"><span id="totalAmountNum">0</span><span class="unit"> å††</span></div>
      </div>
      <div class="result-item">
        <div class="result-item-label">ğŸ›¡ï¸ é€€è·æ‰€å¾—æ§é™¤é¡</div>
        <div class="result-item-value"><span id="deductionNum">0</span><span class="unit"> å††</span></div>
      </div>
      <div class="result-item">
        <div class="result-item-label">ğŸ’¹ èª²ç¨é€€è·æ‰€å¾—</div>
        <div class="result-item-value"><span id="taxableNum">0</span><span class="unit"> å††</span></div>
      </div>
      <div class="result-item">
        <div class="result-item-label">ğŸ›ï¸ æ‰€å¾—ç¨ï¼ˆå¾©èˆˆç¨å«ã‚€ï¼‰</div>
        <div class="result-item-value"><span id="incomeTaxNum">0</span><span class="unit"> å††</span></div>
      </div>
      <div class="result-item">
        <div class="result-item-label">ğŸ™ï¸ ä½æ°‘ç¨ï¼ˆç›®å®‰ï¼‰</div>
        <div class="result-item-value"><span id="residentTaxNum">0</span><span class="unit"> å††</span></div>
      </div>
      <div class="result-item">
        <div class="result-item-label">ğŸ’¸ ç¨é‡‘åˆè¨ˆ</div>
        <div class="result-item-value"><span id="totalTaxNum">0</span><span class="unit"> å††</span></div>
      </div>
    </div>

    <!-- calc basis -->
    <div class="calc-basis">
      <div class="calc-basis-title">ğŸ“‹ è¨ˆç®—ã®æ ¹æ‹ ï¼ˆå›½ç¨åº No.1420 ã«åŸºã¥ãï¼‰</div>
      <div id="calcSteps"></div>
    </div>
  </div>

  <!-- disclaimer -->
  <div class="disclaimer">
    <div class="disclaimer-title">ğŸ“‹ å…è²¬äº‹é …</div>
    <p>
      æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€<a href="https://www.nta.go.jp/taxes/shiraberu/taxanswer/shotoku/1420.htm" target="_blank">å›½ç¨åº No.1420ã€Œé€€è·é‡‘ã‚’å—ã‘å–ã£ãŸã¨ãã€</a>ã®è¨ˆç®—æ–¹å¼ã«åŸºã¥ã„ã¦æ¦‚ç®—ã‚’ç®—å‡ºã™ã‚‹ã‚‚ã®ã§ã™ã€‚<br><br>
      ãƒ»ä½æ°‘ç¨ã¯é€€è·æ‰€å¾—èª²ç¨é¡Ã—10%ï¼ˆæ¨™æº–ç¨ç‡ï¼‰ã§è¨ˆç®—ã—ãŸç›®å®‰ã§ã‚ã‚Šã€å®Ÿéš›ã¯è‡ªæ²»ä½“ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ã€‚<br>
      ãƒ»å‰å¹´ä»¥å‰ã«é€€è·é‡‘ã‚’å—ã‘å–ã£ãŸå ´åˆã‚„ã€åŒä¸€å¹´ã«è¤‡æ•°ã‹æ‰€ã‹ã‚‰å—ã‘å–ã‚‹å ´åˆãªã©ã€æ§é™¤é¡ã®è¨ˆç®—ãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>
      ãƒ»iDeCoã¨ã®åˆç®—è¨ˆç®—ã¯é€šç®—å‹¤å‹™æœŸé–“ç­‰ã«ã‚ˆã‚Šå®Ÿéš›ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
      ãƒ»æœ¬ãƒ„ãƒ¼ãƒ«ã®è¨ˆç®—çµæœã¯ã‚ãã¾ã§å‚è€ƒå€¤ã§ã™ã€‚æ­£ç¢ºãªç¨é¡ã«ã¤ã„ã¦ã¯ã€ç¨ç†å£«ã¾ãŸã¯æ‰€è½„ã®ç¨å‹™ç½²ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br><br>
      è¨ˆç®—å¼ã®æ ¹æ‹ ï¼š<a href="https://www.nta.go.jp/taxes/shiraberu/taxanswer/shotoku/1420.htm" target="_blank">å›½ç¨åº ã‚¿ãƒƒã‚¯ã‚¹ã‚¢ãƒ³ã‚µãƒ¼ No.1420ï¼ˆä»¤å’Œ7å¹´4æœˆ1æ—¥ç¾åœ¨ï¼‰</a>
    </p>
  </div>
</div>

<script>
/* -------- particles -------- */
(function() {
  const wrap = document.getElementById('particles');
  const colors = ['rgba(168,213,186,0.4)','rgba(74,140,111,0.2)','rgba(208,237,220,0.5)','rgba(232,245,241,0.6)'];
  for (let i = 0; i < 18; i++) {
    const p = document.createElement('div');
    const sz = 4 + Math.random() * 10;
    p.style.cssText = `position:absolute;border-radius:50%;width:${sz}px;height:${sz}px;left:${Math.random()*100}%;background:${colors[Math.floor(Math.random()*colors.length)]};animation:particleDrift ${8+Math.random()*14}s ${-Math.random()*16}s linear infinite;`;
    wrap.appendChild(p);
  }
})();

/* -------- toast -------- */
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2600);
}

/* -------- confetti -------- */
function fireConfetti() {
  const wrap = document.getElementById('confetti-wrap');
  const colors = ['#a8d5ba','#4a8c6f','#d4ede3','#e8f5f1','#7fc49e','#2d7a5a'];
  for (let i = 0; i < 55; i++) {
    const c = document.createElement('div');
    c.style.cssText = `position:absolute;left:${10+Math.random()*80}%;top:${-10+Math.random()*5}px;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;background:${colors[Math.floor(Math.random()*colors.length)]};border-radius:${Math.random()>0.5?'50%':'2px'};animation:confettiFall ${1.2+Math.random()*1.3}s ${Math.random()*0.5}s linear forwards;`;
    wrap.appendChild(c);
    setTimeout(() => c.remove(), 3000);
  }
}

/* -------- animate num -------- */
let prevTakeHome = 0;
function animateNum(el, from, to, ms) {
  const t0 = performance.now();
  function step(now) {
    const p = Math.min((now - t0) / ms, 1);
    const ease = 1 - Math.pow(1 - p, 4);
    el.textContent = Math.round(from + (to - from) * ease).toLocaleString('ja-JP');
    if (p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* -------- ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šå…¥åŠ› -------- */
function formatComma(val) {
  const num = val.replace(/[^\d]/g, '');
  return num === '' ? '' : Number(num).toLocaleString('ja-JP');
}
function parseComma(val) {
  return Number(val.replace(/[^\d]/g, '')) || 0;
}
['retirementAmount', 'idecoAmount'].forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('input', function() {
    const pos = this.selectionStart;
    const prevLen = this.value.length;
    this.value = formatComma(this.value);
    const diff = this.value.length - prevLen;
    this.setSelectionRange(pos + diff, pos + diff);
  });
  el.addEventListener('blur', function() {
    this.value = formatComma(this.value);
  });
});

/* -------- quick btn â†’ ã‚«ãƒ³ãƒä»˜ãã§ã‚»ãƒƒãƒˆ -------- */
document.querySelectorAll('.radio-group').forEach(group => {
  group.addEventListener('click', e => {
    const btn = e.target.closest('.radio-btn');
    if (!btn) return;
    group.querySelectorAll('.radio-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // iDeCoç¨®åˆ¥ã®å ´åˆã€å‹¤ç¶šå¹´æ•°ãƒ©ãƒ™ãƒ«å¤‰æ›´
    const typeVal = btn.dataset.val;
    updateYearsLabel();
    // iDeCoã®ã¿é¸æŠæ™‚ã¯åˆç®—ãƒã‚§ãƒƒã‚¯ã‚’éè¡¨ç¤º
    const idecoSection = document.getElementById('idecoSection');
    idecoSection.style.display = typeVal === 'ideco' ? 'none' : '';
  });
});

function getRetirementType() {
  const active = document.querySelector('#retirementType .radio-btn.active');
  return active ? active.dataset.val : 'general';
}

function updateYearsLabel() {
  const label = document.getElementById('yearsLabel');
  const type = getRetirementType();
  label.innerHTML = type === 'ideco'
    ? 'ğŸ“… iDeCoåŠ å…¥æœŸé–“'
    : 'ğŸ“… å‹¤ç¶šå¹´æ•°';
}

// Quick buttons for amount
document.getElementById('amountBtns').addEventListener('click', e => {
  const btn = e.target.closest('.quick-btn');
  if (!btn) return;
  document.getElementById('retirementAmount').value = Number(btn.dataset.val).toLocaleString('ja-JP');
  document.querySelectorAll('#amountBtns .quick-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
});

// Quick buttons for years
document.getElementById('yearsBtns').addEventListener('click', e => {
  const btn = e.target.closest('.quick-btn');
  if (!btn) return;
  document.getElementById('yearsOfService').value = btn.dataset.val;
  document.querySelectorAll('#yearsBtns .quick-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
});

// iDeCo toggle
document.getElementById('hasIdeco').addEventListener('change', function() {
  const sec = document.getElementById('idecoDetails');
  sec.classList.toggle('open', this.checked);
});

/* -------- æ‰€å¾—ç¨é€Ÿç®—è¡¨ -------- */
const TAX_TABLE = [
  { limit: 1_950_000,   rate: 0.05,  deduction: 0 },
  { limit: 3_300_000,   rate: 0.10,  deduction: 97_500 },
  { limit: 6_950_000,   rate: 0.20,  deduction: 427_500 },
  { limit: 9_000_000,   rate: 0.23,  deduction: 636_000 },
  { limit: 18_000_000,  rate: 0.33,  deduction: 1_536_000 },
  { limit: 40_000_000,  rate: 0.40,  deduction: 2_796_000 },
  { limit: Infinity,    rate: 0.45,  deduction: 4_796_000 },
];

function calcIncomeTax(taxableIncome) {
  const income = Math.floor(taxableIncome / 1000) * 1000; // åƒå††æœªæº€åˆ‡ã‚Šæ¨ã¦
  for (const bracket of TAX_TABLE) {
    if (income <= bracket.limit) {
      const base = Math.floor(income * bracket.rate - bracket.deduction);
      // å¾©èˆˆç‰¹åˆ¥æ‰€å¾—ç¨ 2.1%
      return Math.floor(base * 1.021);
    }
  }
  return 0;
}

/* -------- main calc -------- */
function calculate() {
  const amount = parseComma(document.getElementById('retirementAmount').value);
  const years  = Number(document.getElementById('yearsOfService').value);
  const type   = getRetirementType();
  const disability = document.getElementById('disability').checked;
  const hasIdeco   = document.getElementById('hasIdeco').checked && type !== 'ideco';
  const idecoAmt   = hasIdeco ? parseComma(document.getElementById('idecoAmount').value) : 0;
  const idecoYrs   = hasIdeco ? Number(document.getElementById('idecoYears').value || 0) : 0;

  if (!amount || !years) {
    showToast('âš ï¸ é€€è·é‡‘é¡ã¨å‹¤ç¶šå¹´æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  // ---- é€€è·æ‰€å¾—æ§é™¤ ----
  function calcDeduction(y) {
    let d = y <= 20 ? Math.max(400_000 * y, 800_000) : 8_000_000 + 700_000 * (y - 20);
    if (disability) d += 1_000_000;
    return d;
  }

  let totalAmount, deduction, taxableIncome, steps;

  if (type === 'ideco') {
    // iDeCoã®ã¿
    totalAmount = amount;
    deduction = calcDeduction(years);
    const diff = Math.max(totalAmount - deduction, 0);
    taxableIncome = Math.floor(diff / 2); // Ã·2
    steps = buildSteps(type, amount, 0, years, 0, deduction, diff, taxableIncome, disability, false);
  } else if (hasIdeco && idecoAmt > 0 && idecoYrs > 0) {
    // åˆç®—ï¼ˆä¼šç¤¾é€€è·é‡‘ãŒå…ˆï¼‰
    // ä¼šç¤¾é€€è·é‡‘ã®æ§é™¤
    const ded1 = calcDeduction(years);
    // iDeCoã¯ (åŠ å…¥æœŸé–“-é‡è¤‡æœŸé–“) ã§è¿½åŠ æ§é™¤ã€ç°¡æ˜“çš„ã«åˆ¥ã€…è¨ˆç®—ã®å·®åˆ†
    // å®Ÿå‹™ä¸Š: åˆç®—é¡ - max(æ§é™¤1, æ§é™¤2) â€»é‡è¤‡è€ƒæ…®çœç•¥ã§ä¿å®ˆçš„ã«å¤§ãã„æ–¹ã‚’ä½¿ç”¨
    const ded2 = calcDeduction(Math.max(years, idecoYrs));
    deduction = Math.max(ded1, ded2);
    totalAmount = amount + idecoAmt;
    const diff = Math.max(totalAmount - deduction, 0);
    taxableIncome = Math.floor(diff / 2);
    steps = buildSteps(type, amount, idecoAmt, years, idecoYrs, deduction, diff, taxableIncome, disability, true);
  } else {
    // ä¸€èˆ¬
    totalAmount = amount;
    deduction = calcDeduction(years);
    const diff = Math.max(totalAmount - deduction, 0);
    // ç‰¹å®šå½¹å“¡ã¯Ã—1/2ãªã—
    if (type === 'officer') {
      taxableIncome = diff;
    } else if (type === 'short') {
      // çŸ­æœŸï¼š300ä¸‡ä»¥ä¸‹ã¯Ã—1/2ã€è¶…éåˆ†ã¯Ã—1
      if (diff <= 3_000_000) {
        taxableIncome = Math.floor(diff / 2);
      } else {
        taxableIncome = Math.floor(3_000_000 / 2) + (diff - 3_000_000);
      }
    } else {
      taxableIncome = Math.floor(diff / 2);
    }
    steps = buildSteps(type, amount, 0, years, 0, deduction, diff, taxableIncome, disability, false);
  }

  const incomeTax  = calcIncomeTax(taxableIncome);
  const residentTax = Math.floor(taxableIncome * 0.10);
  const totalTax   = incomeTax + residentTax;
  const takeHome   = totalAmount - totalTax;

  // --- update DOM ---
  document.getElementById('emptyState').style.display = 'none';
  const rc = document.getElementById('resultCard');
  rc.classList.add('show');

  const pct = totalAmount > 0 ? Math.round((takeHome / totalAmount) * 100) : 0;
  const taxPct = 100 - pct;

  animateNum(document.getElementById('takeHomeNum'), prevTakeHome, takeHome, 700);
  animateNum(document.getElementById('totalAmountNum'), 0, totalAmount, 500);
  animateNum(document.getElementById('deductionNum'), 0, deduction, 500);
  animateNum(document.getElementById('taxableNum'), 0, taxableIncome, 500);
  animateNum(document.getElementById('incomeTaxNum'), 0, incomeTax, 500);
  animateNum(document.getElementById('residentTaxNum'), 0, residentTax, 500);
  animateNum(document.getElementById('totalTaxNum'), 0, totalTax, 500);

  // bars
  setTimeout(() => {
    document.getElementById('takeBar').style.width = pct + '%';
    document.getElementById('taxBar').style.width  = taxPct + '%';
  }, 100);

  document.getElementById('takePct').textContent = pct + '%';
  document.getElementById('taxPct').textContent  = taxPct + '%';

  // donut
  const circ = 207.3;
  const dedLen  = Math.min((deduction / totalAmount) * circ, circ);
  const taxLen  = Math.min((totalTax / totalAmount) * circ, circ - dedLen);
  const takeLen = Math.min((takeHome / totalAmount) * circ, circ);
  setTimeout(() => {
    document.getElementById('donut-ded').style.strokeDasharray  = `${dedLen} ${circ}`;
    document.getElementById('donut-tax').style.strokeDasharray  = `${taxLen} ${circ}`;
    document.getElementById('donut-tax').style.strokeDashoffset = -dedLen;
    document.getElementById('donut-take').style.strokeDasharray = `${takeLen} ${circ}`;
    document.getElementById('donut-take').style.strokeDashoffset = -(dedLen + taxLen);
  }, 100);

  document.getElementById('donutPct').innerHTML = `<strong>${pct}%</strong>`;

  // steps
  document.getElementById('calcSteps').innerHTML = steps;

  // confetti
  if (Math.abs(takeHome - prevTakeHome) > 200_000 || prevTakeHome === 0) {
    fireConfetti();
    showToast('ğŸ‰ è¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
  }
  prevTakeHome = takeHome;

  // scroll
  setTimeout(() => rc.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
}

function fmt(n) {
  return Math.round(n).toLocaleString('ja-JP');
}

function buildSteps(type, amount, idecoAmt, years, idecoYrs, deduction, diff, taxableIncome, disability, combined) {
  const typeLabel = { general: 'ä¸€èˆ¬é€€è·', officer: 'ç‰¹å®šå½¹å“¡é€€è·', short: 'çŸ­æœŸé€€è·', ideco: 'iDeCoä¸€æ™‚é‡‘' }[type] || 'ä¸€èˆ¬é€€è·';
  const yearsLabel = type === 'ideco' ? 'iDeCoåŠ å…¥æœŸé–“' : 'å‹¤ç¶šå¹´æ•°';

  let s = '';

  s += `<div class="calc-step"><div class="step-num">1</div><div>`;
  if (combined) {
    s += `é€€è·é‡‘ <span class="val">${fmt(amount)}å††</span> ï¼‹ iDeCoä¸€æ™‚é‡‘ <span class="val">${fmt(idecoAmt)}å††</span> ï¼ åˆè¨ˆ <span class="val">${fmt(amount + idecoAmt)}å††</span>`;
  } else {
    s += `é€€è·é‡‘å—å–é¡ï¼š<span class="val">${fmt(amount)}å††</span>ï¼ˆ${typeLabel}ï¼‰`;
  }
  s += `</div></div>`;

  s += `<div class="calc-step"><div class="step-num">2</div><div>`;
  if (combined) {
    s += `${yearsLabel}ï¼š${years}å¹´ï¼ˆä¼šç¤¾ï¼‰ï¼${idecoYrs}å¹´ï¼ˆiDeCoï¼‰ã€€â†’ å®ŸåŠ¹${Math.max(years,idecoYrs)}å¹´ã§æ§é™¤è¨ˆç®—`;
  } else {
    s += `${yearsLabel}ï¼š<span class="val">${years}å¹´</span>`;
  }
  s += `</div></div>`;

  const y = combined ? Math.max(years, idecoYrs) : years;
  const rawDeduction = y <= 20 ? Math.max(400_000 * y, 800_000) : 8_000_000 + 700_000 * (y - 20);
  s += `<div class="calc-step"><div class="step-num">3</div><div>`;
  if (y <= 20) {
    s += `é€€è·æ‰€å¾—æ§é™¤é¡ ï¼ 40ä¸‡å†† Ã— ${y}å¹´ ï¼ <span class="val">${fmt(rawDeduction)}å††</span>`;
  } else {
    s += `é€€è·æ‰€å¾—æ§é™¤é¡ ï¼ 800ä¸‡å†† ï¼‹ 70ä¸‡å†† Ã— (${y}å¹´ ï¼ 20å¹´) ï¼ 800ä¸‡å†† ï¼‹ ${fmt(700_000*(y-20))}å†† ï¼ <span class="val">${fmt(rawDeduction)}å††</span>`;
  }
  if (disability) s += `ã€€ï¼‹ éšœå®³è€…åŠ ç®— 100ä¸‡å†† â†’ åˆè¨ˆ <span class="val">${fmt(deduction)}å††</span>`;
  s += `</div></div>`;

  s += `<div class="calc-step"><div class="step-num">4</div><div>`;
  s += `èª²ç¨å‰é‡‘é¡ ï¼ ${fmt(amount + (combined?idecoAmt:0))}å†† ï¼ æ§é™¤é¡ ${fmt(deduction)}å†† ï¼ <span class="val">${fmt(diff)}å††</span>`;
  s += `</div></div>`;

  s += `<div class="calc-step"><div class="step-num">5</div><div>`;
  if (type === 'officer') {
    s += `èª²ç¨é€€è·æ‰€å¾—ï¼ˆç‰¹å®šå½¹å“¡ï¼š1/2è¨ˆç®—ãªã—ï¼‰ï¼ <span class="val">${fmt(taxableIncome)}å††</span>`;
  } else if (type === 'short') {
    if (diff <= 3_000_000) {
      s += `èª²ç¨é€€è·æ‰€å¾—ï¼ˆçŸ­æœŸãƒ»300ä¸‡ä»¥ä¸‹éƒ¨åˆ†ã®ã¿1/2ï¼‰ï¼ ${fmt(diff)} Ã· 2 ï¼ <span class="val">${fmt(taxableIncome)}å††</span>`;
    } else {
      s += `èª²ç¨é€€è·æ‰€å¾—ï¼ˆçŸ­æœŸï¼š300ä¸‡å††éƒ¨åˆ†ã¯1/2ã€è¶…éåˆ†ã¯ãã®ã¾ã¾ï¼‰ï¼ <span class="val">${fmt(taxableIncome)}å††</span>`;
    }
  } else {
    s += `èª²ç¨é€€è·æ‰€å¾— ï¼ ${fmt(diff)}å†† Ã· 2 ï¼ <span class="val">${fmt(taxableIncome)}å††</span>`;
  }
  s += `</div></div>`;

  s += `<div class="calc-step"><div class="step-num">6</div><div>`;
  s += `æ‰€å¾—ç¨ï¼šè¶…éç´¯é€²ç¨ç‡ï¼ˆé€Ÿç®—è¡¨ï¼‰ã‚’é©ç”¨ â†’ å¾©èˆˆç‰¹åˆ¥æ‰€å¾—ç¨ï¼ˆÃ—1.021ï¼‰ã‚’åŠ ç®—`;
  s += `</div></div>`;

  s += `<div class="calc-step"><div class="step-num">7</div><div>`;
  s += `ä½æ°‘ç¨ï¼ˆç›®å®‰ï¼‰ï¼ èª²ç¨é€€è·æ‰€å¾— Ã— 10%ï¼ˆæ¨™æº–ç¨ç‡ï¼‰`;
  s += `</div></div>`;

  s += `<div class="calc-eq">`;
  s += `<strong>æ‰‹å–ã‚Šé¡</strong> ï¼ å—å–é¡ <span class="em">${fmt(amount+(combined?idecoAmt:0))}</span>å†† ï¼ æ‰€å¾—ç¨ç­‰ ï¼ ä½æ°‘ç¨`;
  s += `<br><small style="color:#7a9a8e;">æ ¹æ‹ ï¼šå›½ç¨åº No.1420 é€€è·é‡‘ã‚’å—ã‘å–ã£ãŸã¨ãï¼ˆé€€è·æ‰€å¾—ï¼‰</small>`;
  s += `</div>`;

  return s;
}
</script>
</body>
</html>
